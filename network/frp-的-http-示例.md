# [frp-的-http-示例](../index/frp-index.md#frp-的-http-示例)

## # 通信原理

![FRP-HTTP](http://123.56.106.144:2233/imgs/FRP-HTTP.png)

![FRP-HTTP](http://123.56.106.144:2233/imgs/OIP.jpg)

1. 启动 frps 后，公网服务器开始监听 7000、2233 (内网计算机映射在公网的端口，用户访问公网服务器的 2233 就相当于访问内网服务器的 80) 端口

2. 启动 frpc 后，内网计算机使用一个随机端口(内网计算机-随机端口-1)，访问公网服务器的 7000 端口

3. 双方经过协商后，建立 **控制链路**（7000 <=> 内网计算机-随机端口-1），用于传输 **控制数据**

4. 同时，内网计算机通过 内网计算机-随机端口-1 向 服务器 7000 发送请求，请求服务器监听 2233 端口，并告知服务器我想要暴露在公网的端口是 80

5. 服务器开始监听 2233 端口

6. 此时，用户想要请求内网服务器的 80 端口，但这是不可能的，故请求服务器 2233 端口

7. 服务器收到用户的请求，然后，服务器通过 **控制链路**（7000 <=> 内网计算机-随机端口-1）告知内网计算机，有外部用户想访问你的 80 端口，你要准备接受请求

8. 但此时 **控制链路**（7000 <=> 内网计算机-随机端口-1）是用来传输控制数据的，是双方协商时需要用的链路，故还需要建立一条 **数据链路** 用来转发用户的请求

9. 此时，服务器随机监听另一个端口（服务器-随机端口-1），告诉内网计算机，你连接我 **服务器-随机端口-1**，我把用户的请求转发给你，内网计算机得知有用户想访问自己的 80 端口和服务器已经监听了另一个端口（服务器-随机端口-1）用来传输数据后，内网计算机也使用了另一个端口（内网计算机-随机端口-2），通过该端口向 **服务器-随机端口-1** 建立连接

10. 此时，服务器与内网计算机已经建立了两条链路了，**控制链路**（7000 <=> 内网计算机-随机端口-1）,**数据链路**（服务器-随机端口-1 <=> 内网计算机-随机端口-2）

11. 两条链路都建立完成后，服务器将 2233 端口 接收到的用户请求，经过内部，转发给 **服务器-随机端口-1**，在通过 **服务器-随机端口-1** 传输给 **内网计算机-随机端口-2**，内网计算机接收到转发过来的用户请求，在自己内部，由 **内网计算机-随机端口-2** 转发给 80 端口

12. 内网计算机 80 端口处理完用户请求后，将响应数据，按原路返回给用户

## # 部署流程

### # 我使用的是阿里云 ECS

我使用的是阿里云 ECS

### # 准备一台内网计算机

我使用的是 RaspberryPi

### # 访问 [frp 的 GitHub](https://github.com/fatedier/frp/)，下载 C / S 端对应的应用程序

我下载的是：

外网服务器需要用：frp_0.65.0_linux_amd64.tar.gz

内网计算机需要用：frp_0.65.0_linux_arm64.tar.gz

### # 将下载的 frps、frps.toml 传输到云服务器(自定义传输的目标位置)

我直接传输到 **/opt/frp** 目录上了

### # 修改 frps.toml 配置文件

```
# frp 服务绑定的端口，提供给内网计算机访问
bindPort = 7000
# 用户计算机访问外网服务器的端口
vhostHTTPPort = 2233
```

### # 将下载的  frpc、frpc.toml 在内网计算机上(自定义传输的目标位置)

我直接传输到我的 **/opt/frp** 目录上了

### # 修改 frpc.toml 配置文件

```
# 外网服务器 IP
serverAddr = "x.x.x.x"
# 网服务器的 Port
serverPort = 7000

[[proxies]]
name = "web"
type = "http"
localPort = 80
customDomains = ["www.xx.com"]
```

### # 在云服务器中，放行 frp 工作时所需要的端口

通过阿里云安全组策略放行 7000、6000 端口

### # 服务器端运行命令

```
sudo ./frps -c frps.toml
```

### # 客户端运行命令

```
sudo ./frpc -c frpc.toml
```

### # 确保内网计算机已运行 http 服务，并尝试通过浏览器访问内网计算机 http 服务

```
http://xx.xx.xx.xx:2233
```

## # 标签

#内网穿透 #FRP

## # 参考链接

[FRP 官方文档](https://gofrp.org/zh-cn/docs/examples/vhost-http/)

## # 反链
